<?php
namespace app\admin\controller;
class Company extends Base
{
    protected $model;
    public function _initialize()
    {
        parent::_initialize(); // TODO: Change the autogenerated stub
        $this->model=model('company');
    }

    public function dataList()
    {
        $where=$this->buildWhere(['name:like']);
        $list=$this->model->data_list($where);
        $this->assign('list', $list);
        return $this->fetch('list');
    }

    public function add(){
        if($this->request->isPost()){
            $data=input();
            $result=$this->model->add($data);
            $this->updateResult($result);
        }else{
            $driver=model('Driver')->selectList();
            $this->assign('driver', $driver);
            return $this->fetch();
        }
    }

    public function edit(){
        if($this->request->isPost()){
            $data=input();
            $result=$this->model->edit($data);
            $this->updateResult($result,'保存成功','dataList');
        }else{
            $id=input('id');
            $data=$this->model->getOne($id);
            if(!$data){
                $this->error($this->model->getError());
            }
            $driver=model('Driver')->selectList();
            $this->assign('driver', $driver);
            $this->assign('data', $data);
            return $this->fetch();
        }
    }

    public function del($id=''){
        if(empty($id)){
            $this->error('参数错误');
        }
        $result=$this->model->del($id);
        $this->updateResult($result,'删除成功','dataList');
    }
}
